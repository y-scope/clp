{{- if and .Values.clpConfig.api_server
           (eq .Values.clpConfig.stream_output.storage.type "s3") }}
{{- include "clp.createLocalPv" (dict
  "root" .
  "component_category" "api-server"
  "name" "staged-streams"
  "nodeRole" "control-plane"
  "capacity" "20Gi"
  "accessModes" (list "ReadWriteMany")
  "hostPath" (printf "%s/staged-streams" .Values.clpConfig.data_directory)
) }}
{{- end }}
