version: "3"

includes:
  # Main targets
  core: "core.yaml"
  spider: "spider.yaml"
  log-viewer: "log-viewer.yaml"

  # Utils
  utils: "utils.yaml"
  yscope-dev-utils: "../../tools/yscope-dev-utils/exports/taskfiles/utils/utils.yaml"

  # Individual component tasks
  artifacts:
    flatten: true
    taskfile: "artifacts.yaml"
  cmake-libs:
    flatten: true
    taskfile: "cmake-libs.yaml"
  misc-libs:
    flatten: true
    taskfile: "misc-libs.yaml"

vars:
  # Directories
  G_DEPS_DIR: "{{.G_BUILD_DIR}}/deps"
  G_DEPS_CPP_DIR: "{{.G_DEPS_DIR}}/cpp"

  # Checksum dirs and paths
  G_DEPS_CPP_CHECKSUMS_DIR: "{{.G_DEPS_CPP_DIR}}/checksums"
  G_DEPS_CPP_CHECKSUM_FILE: "{{.G_DEPS_CPP_CHECKSUMS_DIR}}/all.md5"

  # CMake settings paths
  # NOTE: This must be kept in-sync with its usage in components/core/CMakeLists.txt
  G_DEPS_CPP_CMAKE_SETTINGS_DIR: "{{.G_DEPS_CPP_DIR}}/cmake-settings"

  # Antlr
  G_ANTLR_VERSION: "4.13.2"
  G_ANTLR_JAR_FILE: "{{.G_DEPS_CPP_DIR}}/antlr-{{.G_ANTLR_VERSION}}-complete.jar"

tasks:
  default:
    deps:
      - "core"
      - "spider"
      - "log-viewer"

  init:
    internal: true
    run: "once"
    cmds:
      - "mkdir -p '{{.G_DEPS_DIR}}'"
      - "mkdir -p '{{.G_DEPS_CPP_DIR}}'"
      - "mkdir -p '{{.G_DEPS_CPP_CHECKSUMS_DIR}}'"
      - "mkdir -p '{{.G_DEPS_CPP_CMAKE_SETTINGS_DIR}}'"
