version: "3"

env:
  CLP_BUILD_DIR: "{{.G_BUILD_DIR}}"
  CLP_CORE_BINS_DIR: "{{.G_CORE_COMPONENT_BUILD_DIR}}"
  CLP_PACKAGE_DIR: "{{.G_PACKAGE_BUILD_DIR}}"

tasks:
  default:
    deps:
      - "core"

  cache-clear:
    dir: "{{.G_INTEGRATION_TESTS_DIR}}"
    cmds:
      - >-
        uv run python -m pytest --cache-clear --collect-only --override-ini addopts="" --quiet
        > /dev/null

  core:
    deps:
      - "::core"
    dir: "{{.G_INTEGRATION_TESTS_DIR}}"
    cmds:
      - >-
        uv run python -m pytest -m "core"
