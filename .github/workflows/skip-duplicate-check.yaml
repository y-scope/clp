name: "skip-duplicate-check"

# Reusable workflow to skip duplicate runs when both push and pull_request events trigger on the
# same commit. Other workflows can call this and check the `should_skip` output to avoid redundant
# work.
#
# Usage:
#   jobs:
#     skip-check:
#       uses: "./.github/workflows/skip-duplicate-check.yaml"
#
#     my-job:
#       needs: "skip-check"
#       if: "needs.skip-check.outputs.should_skip != 'true'"
#       ...

on:
  workflow_call:
    outputs:
      should_skip:
        description: "Whether the workflow run should be skipped"
        value: "${{jobs.check.outputs.should_skip}}"

jobs:
  check:
    name: "skip-duplicate-check"
    runs-on: "ubuntu-24.04"
    outputs:
      should_skip: "${{steps.skip_check.outputs.should_skip}}"
    steps:
      - id: "skip_check"
        uses: "fkirc/skip-duplicate-actions@v5"
        with:
          # Skip duplicate runs for the same content (e.g., when both push and pull_request trigger)
          concurrent_skipping: "same_content"
          skip_after_successful_duplicate: "true"
          # Always run for scheduled builds and manual triggers.
          # NOTE: This is a JSON array string (required by the action), with escaped quotes for
          # yamllint compliance.
          do_not_skip: "[\"schedule\", \"workflow_dispatch\"]"
